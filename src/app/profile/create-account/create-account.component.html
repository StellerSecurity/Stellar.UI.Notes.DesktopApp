<ion-content class="ion-padding user-account-section-container" scroll-y="false">
  <div class="user-account-section">
    <!-- Top Logo Section -->
    <div class="top-section">
      <div class="logo-container">
        <img class="login-app-logo-img" src="./assets/note-logo-white-bg.png" alt="">
        <div class="app-name">{{'stellarPrivateNotes' | translate}}</div>
      </div>
    </div>

    <!-- FORM SECTION -->
    <div class="form-card" *ngIf="!showVerificationSection">
      <ion-button fill="clear" size="small" class="back-button" (click)="goBack()">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>

      <div class="form-card-content">
        <div class="title">{{'createStellarID' | translate}}</div>
        <p class="subtitle">{{'pleaseEnterEmailAndPasswordToCreateYourFreeStellarID' | translate}}</p>

        <form [formGroup]="createUserForm" (ngSubmit)="createAccount()">
          <!-- Email -->
          <ion-item class="input-field" lines="none" style="margin-bottom: 0;">
            <ion-input
              placeholder="Email"
              type="email"
              formControlName="email"
              [ngClass]="{'border-danger': createUserForm.get('email')?.invalid && createUserForm.get('email')?.touched}">
            </ion-input>
          </ion-item>
          <ion-text color="danger" *ngIf="createUserForm.get('email')?.hasError('required') && createUserForm.get('email')?.touched">
            <small>{{'emailIsRequired' | translate}}</small>
          </ion-text>
          <ion-text color="danger" *ngIf="createUserForm.get('email')?.hasError('email') && createUserForm.get('email')?.touched">
            <small>{{'invalidEmailFormat' | translate}}</small>
          </ion-text>


          <!-- Password -->
          <ion-item
            class="input-field"
            lines="none"
            style="margin-top: 16px"
            [ngClass]="{
              'mb-0': createUserForm.get('password')?.invalid && createUserForm.get('password')?.touched
            }"
          >
            <ion-input
              [type]="showPassword ? 'text' : 'password'"
              placeholder="Password"
              formControlName="password"
              [ngClass]="{
                'border-danger': createUserForm.get('password')?.invalid && createUserForm.get('password')?.touched
              }"
            ></ion-input>

            <ion-icon
              name="{{ showPassword ? 'eye-off-outline' : 'eye-outline' }}"
              slot="end"
              class="password-toggle"
              (click)="togglePasswordVisibility()"
            ></ion-icon>
          </ion-item>

          <ion-text color="danger" *ngIf="createUserForm.get('password')?.hasError('required') && createUserForm.get('password')?.touched">
            <small>{{'passwordIsRequired' | translate}}</small>
          </ion-text>
          <ion-text color="danger" *ngIf="createUserForm.get('password')?.hasError('minlength') && createUserForm.get('password')?.touched">
            <small>{{'passwordAtLeastLength' | translate}}</small>
          </ion-text>

          <!-- Submit -->
          <ion-button
            class="create-button"
            expand="block"
            type="submit"
          >
            <ng-container *ngIf="!isSaving; else createUserTpl">
              {{ 'createAccount' | translate }}
            </ng-container>

            <ng-template #createUserTpl>
              <ion-spinner name="crescent" slot="start" class="ion-margin-end"></ion-spinner>
              {{ 'creatingAccount' | translate }}
            </ng-template>
          </ion-button>
        </form>

        <div class="footer">
          <span class="label-beforee-link">{{'alreadyHaveStellarID' | translate}} </span>
          <a (click)="goToLogin()">{{'login' | translate}}</a>
        </div>
      </div>
    </div>

    <!-- VERIFICATION SECTION -->
    <div class="form-card" *ngIf="showVerificationSection">
      <div class="form-card-content">
        <div class="verify-icon">
          <!-- <ion-icon name="mail-outline" class="mail-icon"></ion-icon> -->
          <img src="./assets/tabler-icon-mail-forward.png" width="40" height="40">
        </div>
        <div class="title" style="margin-top: 14px;">{{'pleaseInputCode' | translate}}</div>
        <p class="subtitle">{{'weSentAnAccountVerificationCodeTo' | translate}} <strong>{{ email }}</strong></p>

        <div class="code-input-wrapper">
          <ng-otp-input (onInputChange)="onOtpChange($event)" [config]="otpConfig" containerClass="ng-ong-otp-box">
          </ng-otp-input>
        </div>

        <div class="resend-section">
          {{'dontReceiveACode' | translate}}
          <a (click)="resendCode()">{{'resenCode' | translate}}</a>
        </div>

        <div class="footer">
          <div class="change-email">
            <a (click)="changeEmail()">{{'signupWithDifferentEmail' | translate}}</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>
